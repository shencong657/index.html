<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDKé¢†å–ä¸­å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .cdk-card {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .cdk-item {
            margin: 10px 0;
            font-size: 18px;
        }
        
        .cdk-label {
            font-weight: bold;
            color: #555;
            margin-right: 10px;
        }
        
        .btn-container {
            text-align: center;
            margin: 20px 0;
        }
        
        #getCdkBtn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        #getCdkBtn:hover {
            background: #0056b3;
        }
        
        #getCdkBtn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .info-text {
            text-align: center;
            color: #666;
            margin: 15px 0;
            font-size: 16px;
        }
        
        .warning {
            color: #dc3545;
            font-weight: bold;
        }
        
        .success {
            color: #28a745;
            font-weight: bold;
        }
        
        .usage-info {
            background: #e9f7fe;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CDKé¢†å–ä¸­å¿ƒ</h1>
        
        <div class="info-text" id="statusText">
            ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é¢†å–CDKï¼Œæ¯äºº3å¤©å†…æœ€å¤šé¢†å–7æ¬¡ï¼Œä¸”é¢†å–çš„CDKä¸é‡å¤
        </div>
        
        <div class="btn-container">
            <button id="getCdkBtn" onclick="getCDK()">é¢†å–CDK</button>
        </div>
        
        <div class="cdk-card" id="cdkCard">
            <div class="cdk-item">
                <span class="cdk-label">CDKï¼š</span>
                <span id="cdkCode"></span>
            </div>
            <div class="cdk-item">
                <span class="cdk-label">åŠ©åŠ›ç ï¼š</span>
                <span id="inviteCode"></span>
            </div>
        </div>
        
        <div class="usage-info">
            <p>ğŸ“Œ é¢†å–è§„åˆ™ï¼š</p>
            <ul>
                <li>æ¯ä¸ªç”¨æˆ·3å¤©å†…æœ€å¤šå¯é¢†å–7æ¬¡CDK</li>
                <li>æ¯æ¬¡é¢†å–çš„CDKéƒ½ä¸ä¼šé‡å¤</li>
                <li>3å¤©å†…æ‰€æœ‰ç”¨æˆ·é¢†å–çš„CDKéƒ½ä¸é‡å¤</li>
                <li>ç¬¬å››å¤©å¼€å§‹ï¼ŒCDKæ± ä¼šé‡ç½®ï¼Œå¯é¢†å–ç¬¬ä¸€å¤©å‘æ”¾è¿‡çš„CDK</li>
                <li>å½“å‰å·²é¢†å–æ¬¡æ•°ï¼š<span id="usedCount">0</span>/7</li>
                <li>è·ç¦»é‡ç½®æ—¶é—´ï¼š<span id="resetTime">0</span>å°æ—¶</li>
            </ul>
        </div>
    </div>

    <script>
        // CDKæ•°æ®åˆ—è¡¨ - æ›¿æ¢ä¸ºä½ çš„200ç»„CDK
        const cdkList = [
            { cdk: "ks2BX5jm", invite: "10WsWekjrB" },
            { cdk: "8juatHcb", invite: "GPHkHvvqZq" },
            { cdk: "B4NROpIY", invite: "GxQm1j0QHP" },
            { cdk: "LjuBSVtj", invite: "beeTG7lOiq" },
            { cdk: "MHQk6p54", invite: "wE9eiuhYNN" },
            { cdk: "DxOTQjoP", invite: "stnVz0Ovjv" },
            { cdk: "3dMr53Gw", invite: "TodYSxDfS6" },
            { cdk: "qYm1sONo", invite: "MsDVHwRW6k" },
            { cdk: "2Ygl0buT", invite: "YfLWgWcCXe" },
            { cdk: "YtjAs3rx", invite: "jK5kWTT5Hn" },
            { cdk: "TVhsFSnn", invite: "arshMo3RHO" },
            { cdk: "S1U04aOb", invite: "ShLCPCX4VT" },
            { cdk: "XCdVqgGX", invite: "yz6USv0kpG" },
            { cdk: "PZZMBSgR", invite: "QZjnhtK7TM" },
            { cdk: "BRk6025E", invite: "gxERWW7oKR" },
            { cdk: "k6iFag3c", invite: "WGrhb6Gqzk" },
            { cdk: "3EsHDukT", invite: "HBvHtOda6l" },
            { cdk: "pOSNjTHU", invite: "nkHFzZks9e" },
            { cdk: "PDGI9x2T", invite: "hll2qLq1Qd" },
            { cdk: "lwystvTB", invite: "9AAxuzymV0" },
            { cdk: "HWoIhYOz", invite: "DD54nZjGBk" },
            { cdk: "I3O77sZk", invite: "N9SeSyO3gR" },
            { cdk: "OEDozIIr", invite: "GcL3MUCfYt" },
            { cdk: "95oThX4j", invite: "z5KgN11Xuy" },
            { cdk: "jUNm0H4w", invite: "gpM4oVOH2L" },
            { cdk: "sPcN6dl5", invite: "GVyxT9Bfso" },
            { cdk: "nhe26yNS", invite: "FyZFabxOru" },
            { cdk: "Ytixf04R", invite: "nRq6erUdKU" },
            { cdk: "rbzmWj1O", invite: "mkQloEeLat" },
            { cdk: "D8fnzI9p", invite: "GGahUUFfIf" },
            { cdk: "NtLlgGFP", invite: "nkaQiIOleU" },
            { cdk: "xAGIG1rq", invite: "3cCq83QfU3" },
            { cdk: "HLHQRKe8", invite: "hsKZwmlea6" },
            { cdk: "uWpSqA9O", invite: "cIuSWTltAl" },
            { cdk: "U3Tc5xHb", invite: "Gpz0bzOfRO" },
            { cdk: "9jiYgu8x", invite: "uHgFlRGoiS" },
            { cdk: "vI4XTsQ6", invite: "pVyHY4gKYg" },
            { cdk: "GgcUWYAi", invite: "hqhHIVsC1g" },
            { cdk: "YIkdSAd7", invite: "EzpKcChDeU" },
            { cdk: "9oErToLC", invite: "MWvoSYS5TH" },
            { cdk: "wNLUxayA", invite: "CiojAEkXu3" },
            { cdk: "84VdUlIO", invite: "rgQLSmKpNs" },
            { cdk: "nTxVlHeY", invite: "0AkmxiwsmG" },
            { cdk: "U2A2NRZa", invite: "LN9qSbC3Vz" },
            { cdk: "U8xYDr8K", invite: "VAx1oZqOcf" },
            { cdk: "bX1FCEat", invite: "QxIoKuaOgm" },
            { cdk: "eE7SAl9K", invite: "1eF2t5jeLd" },
            { cdk: "jkF45K59", invite: "oI8BsdXfgG" },
            { cdk: "DqNiROLH", invite: "Q5aNnOX5w7" },
            { cdk: "oh2K8PPj", invite: "2tSj1F6SMC" },
            { cdk: "XClv7gAk", invite: "KSNnfZGeOA" },
            { cdk: "GZMcC1Ww", invite: "WFUKuT3uiW" },
            { cdk: "H3vrn83b", invite: "OVgoWxjtuE" },
            { cdk: "ODMpTRem", invite: "ZjKTEepXQu" },
            { cdk: "mqeNs6ST", invite: "P5fB3LhzpB" },
            { cdk: "zGGDhuQ3", invite: "qUI90dt8iX" },
            { cdk: "vyLQ8X6P", invite: "VWt9275GI8" },
            { cdk: "CbuRWTrX", invite: "ahahyFESuH" },
            { cdk: "B7dIIsbd", invite: "uNlSGsV9i0" },
            { cdk: "7QMSmk7u", invite: "GnOhPcBBQd" },
            { cdk: "eOB6w4zK", invite: "U10jdFg2GG" },
            { cdk: "3Uq7bV8L", invite: "bvqVvh9si2" },
            { cdk: "l7Wgpln8", invite: "eM1146l60r" },
            { cdk: "eQKqHlIw", invite: "bf2Q3A8Nic" },
            { cdk: "ipdHQ0V8", invite: "3WcyWNHs2C" },
            { cdk: "pmd3okUX", invite: "pZ0sbIr6Lf" },
            { cdk: "TDnZLfzf", invite: "x61GcvxQHC" },
            { cdk: "V1BTLccz", invite: "GO0h0e2Zgg" },
            { cdk: "gUu0lDek", invite: "mrynPzhBws" },
            { cdk: "BwEShq69", invite: "XX5LW0e4a5" },
            { cdk: "TitsOLUR", invite: "hQPiF4M1Z6" },
            { cdk: "pPDHQdOp", invite: "Dgnw0QxPHi" },
            { cdk: "5KFXmDG7", invite: "40g4RLK6YB" },
            { cdk: "HZSILTq3", invite: "w5mywkXYTb" },
            { cdk: "rrUqCWyn", invite: "Uf8O8mC1NM" },
            { cdk: "BFeqSpmX", invite: "aUdNfbbSdY" },
            { cdk: "3veU7Hu2", invite: "Dab2XlrA7O" },
            { cdk: "sXSOeHT6", invite: "nllazWHuxz" },
            { cdk: "qTUGz9Hb", invite: "FZmUEGFZ1D" },
            { cdk: "MHCiFvLB", invite: "Ip3OQwCROZ" },
            { cdk: "vcvQj9kH", invite: "ZUYHqt0YiP" },
            { cdk: "n7IoKnUb", invite: "4pQalyDGcA" },
            { cdk: "aMPUGR9s", invite: "Z6oztHqi9K" },
            { cdk: "KQAONZff", invite: "iIoIOKH8Gj" },
            { cdk: "97u8sK1x", invite: "H8FCgqOK20" },
            { cdk: "GPuw8RGq", invite: "hpRTtZRRhc" },
            { cdk: "MDgsMH91", invite: "tPUmW5fOww" },
            { cdk: "48g1k3uf", invite: "DBEU8lo7Wg" },
            { cdk: "XMmEOT9G", invite: "AGeXrT4wPS" },
            { cdk: "xGXi4bRA", invite: "Nl30UGvjfG" },
            { cdk: "lmErkGXL", invite: "Biqibb9m3E" },
            { cdk: "w5VDiAzK", invite: "cWoeMSuFha" },
            { cdk: "g7w4SVW6", invite: "TYP4aPykuH" },
            { cdk: "Ush5RSNE", invite: "1FHPqpwIMR" },
            { cdk: "ehsM4y7Q", invite: "VA6458GcwY" },
            { cdk: "xqo3UbUh", invite: "A4SgkgNy7S" },
            { cdk: "k2Gbod2Y", invite: "SZ13ZPKEFs" },
            { cdk: "l5EApIv5", invite: "Mva2YYa7Kp" },
            { cdk: "oWYdB98q", invite: "l3MIlnC3sc" },
            { cdk: "MOwPQBIy", invite: "HzSi3OSu63" }
            // å¯ä»¥ç»§ç»­æ·»åŠ å‰©ä½™çš„CDK
        ];

        // é…ç½®é¡¹
        const CONFIG = {
            MAX_CLAIMS_PER_PERIOD: 7,    // æ¯å‘¨æœŸæœ€å¤šé¢†å–æ¬¡æ•°
            PERIOD_DURATION: 3 * 24 * 60 * 60 * 1000, // å‘¨æœŸæ—¶é•¿ï¼ˆ3å¤©ï¼Œæ¯«ç§’ï¼‰
        };

        // åˆå§‹åŒ–é¡µé¢
        window.onload = function() {
            updateUsageInfo();
            checkClaimStatus();
        };

        // è·å–ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼ˆç®€å•å®ç°ï¼ŒåŸºäºæœ¬åœ°å­˜å‚¨ï¼‰
        function getUserId() {
            let userId = localStorage.getItem('cdk_user_id');
            if (!userId) {
                userId = generateUUID();
                localStorage.setItem('cdk_user_id', userId);
            }
            return userId;
        }

        // ç”ŸæˆUUID
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // è·å–ç”¨æˆ·é¢†å–è®°å½•
        function getUserClaimRecord() {
            const record = localStorage.getItem('cdk_user_claims');
            return record ? JSON.parse(record) : {
                claims: [],          // é¢†å–è®°å½•
                periodStart: Date.now() // å‘¨æœŸå¼€å§‹æ—¶é—´
            };
        }

        // è·å–å…¨å±€å‘æ”¾è®°å½•
        function getGlobalClaimRecord() {
            const record = localStorage.getItem('cdk_global_claims');
            return record ? JSON.parse(record) : {
                issuedCdks: [],      // å·²å‘æ”¾çš„CDK
                periodStart: Date.now() // å‘¨æœŸå¼€å§‹æ—¶é—´
            };
        }

        // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®å‘¨æœŸ
        function checkAndResetPeriod(userRecord, globalRecord) {
            const now = Date.now();
            
            // æ£€æŸ¥ç”¨æˆ·å‘¨æœŸ
            if (now - userRecord.periodStart > CONFIG.PERIOD_DURATION) {
                userRecord.claims = [];
                userRecord.periodStart = now;
                localStorage.setItem('cdk_user_claims', JSON.stringify(userRecord));
            }
            
            // æ£€æŸ¥å…¨å±€å‘¨æœŸ
            if (now - globalRecord.periodStart > CONFIG.PERIOD_DURATION) {
                globalRecord.issuedCdks = [];
                globalRecord.periodStart = now;
                localStorage.setItem('cdk_global_claims', JSON.stringify(globalRecord));
            }
            
            return { userRecord, globalRecord };
        }

        // æ›´æ–°ä½¿ç”¨ä¿¡æ¯æ˜¾ç¤º
        function updateUsageInfo() {
            const userRecord = getUserClaimRecord();
            const now = Date.now();
            
            // è®¡ç®—å·²é¢†å–æ¬¡æ•°
            const usedCount = userRecord.claims.length;
            document.getElementById('usedCount').textContent = usedCount;
            
            // è®¡ç®—å‰©ä½™æ—¶é—´
            const timeLeft = Math.max(0, (userRecord.periodStart + CONFIG.PERIOD_DURATION) - now);
            const hoursLeft = Math.ceil(timeLeft / (60 * 60 * 1000));
            document.getElementById('resetTime').textContent = hoursLeft;
        }

        // æ£€æŸ¥é¢†å–çŠ¶æ€
        function checkClaimStatus() {
            const userRecord = getUserClaimRecord();
            const { userRecord: updatedUserRecord } = checkAndResetPeriod(userRecord, getGlobalClaimRecord());
            
            const btn = document.getElementById('getCdkBtn');
            const statusText = document.getElementById('statusText');
            
            if (updatedUserRecord.claims.length >= CONFIG.MAX_CLAIMS_PER_PERIOD) {
                btn.disabled = true;
                statusText.textContent = `ä½ å·²è¾¾åˆ°3å¤©å†…æœ€å¤§é¢†å–æ¬¡æ•°(${CONFIG.MAX_CLAIMS_PER_PERIOD}æ¬¡)ï¼Œè¯·ç­‰å¾…å‘¨æœŸé‡ç½®åå†è¯•ï¼`;
                statusText.className = 'info-text warning';
            } else {
                btn.disabled = false;
                statusText.textContent = `ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é¢†å–CDKï¼Œæ¯äºº3å¤©å†…æœ€å¤šé¢†å–${CONFIG.MAX_CLAIMS_PER_PERIOD}æ¬¡ï¼Œä¸”é¢†å–çš„CDKä¸é‡å¤`;
                statusText.className = 'info-text';
            }
        }

        // éšæœºè·å–æœªå‘æ”¾çš„CDK
        function getUnissuedCDK(globalRecord) {
            // è¿‡æ»¤å‡ºæœªå‘æ”¾çš„CDK
            const availableCdks = cdkList.filter(item => !globalRecord.issuedCdks.includes(item.cdk));
            
            // å¦‚æœæ‰€æœ‰CDKéƒ½å·²å‘æ”¾ï¼Œè¿”å›null
            if (availableCdks.length === 0) {
                return null;
            }
            
            // éšæœºé€‰æ‹©ä¸€ä¸ª
            const randomIndex = Math.floor(Math.random() * availableCdks.length);
            return availableCdks[randomIndex];
        }

        // é¢†å–CDKä¸»å‡½æ•°
        function getCDK() {
            try {
                // è·å–è®°å½•å¹¶æ£€æŸ¥å‘¨æœŸ
                let userRecord = getUserClaimRecord();
                let globalRecord = getGlobalClaimRecord();
                
                const { userRecord: updatedUserRecord, globalRecord: updatedGlobalRecord } = checkAndResetPeriod(userRecord, globalRecord);
                
                // æ£€æŸ¥é¢†å–æ¬¡æ•°é™åˆ¶
                if (updatedUserRecord.claims.length >= CONFIG.MAX_CLAIMS_PER_PERIOD) {
                    document.getElementById('statusText').textContent = `ä½ å·²è¾¾åˆ°3å¤©å†…æœ€å¤§é¢†å–æ¬¡æ•°(${CONFIG.MAX_CLAIMS_PER_PERIOD}æ¬¡)ï¼`;
                    document.getElementById('statusText').className = 'info-text warning';
                    return;
                }
                
                // è·å–æœªå‘æ”¾çš„CDK
                const cdkItem = getUnissuedCDK(updatedGlobalRecord);
                if (!cdkItem) {
                    document.getElementById('statusText').textContent = 'å½“å‰æš‚æ— å¯ç”¨çš„CDKï¼Œè¯·ç¨åå†è¯•ï¼';
                    document.getElementById('statusText').className = 'info-text warning';
                    return;
                }
                
                // æ›´æ–°è®°å½•
                updatedUserRecord.claims.push({
                    cdk: cdkItem.cdk,
                    invite: cdkItem.invite,
                    timestamp: Date.now()
                });
                
                updatedGlobalRecord.issuedCdks.push(cdkItem.cdk);
                
                // ä¿å­˜è®°å½•
                localStorage.setItem('cdk_user_claims', JSON.stringify(updatedUserRecord));
                localStorage.setItem('cdk_global_claims', JSON.stringify(updatedGlobalRecord));
                
                // æ˜¾ç¤ºCDK
                document.getElementById('cdkCode').textContent = cdkItem.cdk;
                document.getElementById('inviteCode').textContent = cdkItem.invite;
                document.getElementById('cdkCard').style.display = 'block';
                
                // æ›´æ–°çŠ¶æ€å’Œä½¿ç”¨ä¿¡æ¯
                document.getElementById('statusText').textContent = 'é¢†å–æˆåŠŸï¼CDKå’ŒåŠ©åŠ›ç å¦‚ä¸‹ï¼š';
                document.getElementById('statusText').className = 'info-text success';
                updateUsageInfo();
                checkClaimStatus();
                
            } catch (error) {
                console.error('é¢†å–CDKå‡ºé”™:', error);
                document.getElementById('statusText').textContent = 'é¢†å–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼';
                document.getElementById('statusText').className = 'info-text warning';
            }
        }
    </script>
</body>
</html>
